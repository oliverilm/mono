{"version":3,"file":"MigrateConverter.mjs","sources":["../../../src/composers/migrate/MigrateConverter.ts"],"sourcesContent":["import { OpenApi } from \"../../OpenApi\";\nimport { IHttpMigrateApplication } from \"../../structures/IHttpMigrateApplication\";\nimport { IHttpMigrateRoute } from \"../../structures/IHttpMigrateRoute\";\nimport { EndpointUtil } from \"../../utils/EndpointUtil\";\nimport { HttpMigrateApplicationComposer } from \"../HttpMigrateApplicationComposer\";\nimport { MigrateRouteAccessor } from \"./MigrateRouteAccessor\";\n\nexport namespace MigrateConverter {\n  export const convert = (\n    document: OpenApi.IDocument,\n  ): IHttpMigrateApplication => {\n    const errors: IHttpMigrateApplication.IError[] = [];\n    const entire: Array<IHttpMigrateRoute | null> = Object.entries({\n      ...(document.paths ?? {}),\n      ...(document.webhooks ?? {}),\n    })\n      .map(([path, collection]) =>\n        ([\"head\", \"get\", \"post\", \"put\", \"patch\", \"delete\"] as const)\n          .filter((method) => collection[method] !== undefined)\n          .map((method) => {\n            const operation: OpenApi.IOperation = collection[method]!;\n            const migrated: IHttpMigrateRoute | string[] =\n              HttpMigrateApplicationComposer.application({\n                document,\n                method,\n                path,\n                emendedPath: EndpointUtil.reJoinWithDecimalParameters(path),\n                operation,\n              });\n            if (Array.isArray(migrated)) {\n              errors.push({\n                method,\n                path,\n                operation: () => operation,\n                messages: migrated,\n              });\n              return null;\n            }\n            return migrated;\n          }),\n      )\n      .flat();\n    const operations: IHttpMigrateRoute[] = entire.filter(\n      (o): o is IHttpMigrateRoute => !!o,\n    );\n    MigrateRouteAccessor.overwrite(operations);\n    return {\n      document: () => document,\n      routes: operations,\n      errors,\n    } satisfies IHttpMigrateApplication as IHttpMigrateApplication;\n  };\n}\n"],"names":["MigrateConverter","convert","document","errors","entire","Object","entries","paths","webhooks","map","path","collection","filter","method","undefined","operation","migrated","HttpMigrateApplicationComposer","application","emendedPath","EndpointUtil","reJoinWithDecimalParameters","Array","isArray","push","messages","flat","operations","o","MigrateRouteAccessor","overwrite","routes"],"mappings":";;;;;;AAOM,IAAWA;;CAAjB,SAAiBA;IACFA,iBAAAC,UACXC;QAEA,MAAMC,SAA2C;QACjD,MAAMC,SAA0CC,OAAOC,QAAQ;eACzDJ,SAASK,SAAS;eAClBL,SAASM,YAAY;WAExBC,KAAI,EAAEC,MAAMC,gBACV,EAAC,QAAQ,OAAO,QAAQ,OAAO,SAAS,WACtCC,QAAQC,UAAWF,WAAWE,YAAYC,YAC1CL,KAAKI;YACJ,MAAME,YAAgCJ,WAAWE;YACjD,MAAMG,WACJC,+BAA+BC,YAAY;gBACzChB;gBACAW;gBACAH;gBACAS,aAAaC,aAAaC,4BAA4BX;gBACtDK;;YAEJ,IAAIO,MAAMC,QAAQP,WAAW;gBAC3Bb,OAAOqB,KAAK;oBACVX;oBACAH;oBACAK,WAAW,MAAMA;oBACjBU,UAAUT;;gBAEZ,OAAO;;YAET,OAAOA;AAAQ,cAGpBU;QACH,MAAMC,aAAkCvB,OAAOQ,QAC5CgB,OAAgCA;QAEnCC,qBAAqBC,UAAUH;QAC/B,OAAO;YACLzB,UAAU,MAAMA;YAChB6B,QAAQJ;YACRxB;;AAC4D;AAEjE,EA7CD,CAAiBH,qBAAAA,mBA6ChB,CAAA;;"}